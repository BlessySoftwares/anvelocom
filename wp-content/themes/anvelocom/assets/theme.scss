/* Special decorations for this site
*/



/* Brands will be naked unlike product thumbs
*/
@mixin remove-thumb-anvelocom {
  article {
    &.thumb {
      height: auto !important;
      
      figure {
        height: auto !important;
        border: none;
        padding: 0;
        
        figcaption {
          display: none;
          margin: 0;
        }
      }
    }
  }
}



/* The product thumb must be styled specially for this theme
*/
@mixin thumb-anvelocom($figcaption: true, $price: true) {
  article {
    &.thumb, &.product {
      height: 19em;
      
      @include landscape {
        height: 23em;
      }
    
      figure {
        height: 17em;
        
        @include landscape {
          height: 21em;
        }
        
        @include bordered;
        
        background: $background;
        position: relative;
        
        &:after {
          content: '';
          @include bordered;
          
          top: 2%;
          left: 2%;
          width: 93%;
          height: 94%;
          
          position: absolute;
          z-index: -1;
        }
        
        div {
          max-height: 10em;
          overflow: hidden;
          
          img {
            width: 100%;
          }
        }
        
        figcaption {
          margin: $pad 0;
        }
      }
      
      @if ($figcaption != true) {
        figcaption {
          display: none;
        }
      }
      
      @if ($price != false) {
        aside {
          display: block;
          @include remove-title;
          
          #dimension, #content {
            display: none;
          }
          
          #price {
            display: block;
            @include price;
            
            position: relative;
            top: -$pad - $pad/2;
            left: $pad/2;
          }
        }
      }
    }
  }
}


/* Display a single post
*/
@mixin single {
  header {
    display: none;
  }
  
  figure {
    figcaption {
      display: none;
    }
    
    @include mobile {
      div {
        img {
          width: 100%;
        }
      }
    }
    
    margin-bottom: $pad;
  }
  
  aside {
    background: white; 
    padding: $pad;
    width: col-resize($major - 5%, $pad*2, 0px);
    @include below-small-screen {
      width: col-resize(100%, $pad*2, 0px);
    } 
  
    #price {
      @include price;
    }
    
    #price, #dimension {
      @include block;
      @include bordered;
      width: 51%;
      margin-bottom: $pad;
      
      @include mobile {
        width: col-resize(100%, $pad*2, 0px);
      }
    }
    
    #content {
      @include block;
      @include body-text;
      
      img {
        display: none;
      }
    }
  }
}


/* Display page content
*/
@mixin page {
  background: white; 
  padding: $pad;
  
  figure {
    display: none;
  }
  
  aside {
    #price, #dimension {
      display: none;
    }
    
    #content {
      img {
        width: 100%;
      }
    }
  }
}


@mixin comments {
  max-width: $body-text-width;
  margin: $pad 0;
  
  @include color(invert);
  padding: $pad;
  width: calc(100% - #{$pad*2});
  
  @include form;
  
  h3, h2 {
    margin-bottom: $pad;
  }
  
  ol {
    li {
      margin-bottom: $pad;
      padding-bottom: $pad;
      border-bottom: 1px solid $gray;
      
      @include body-text;
      
      a {
        @include link($highlight);
      }
      
      .reply {
        margin: $pad/2 0;
      }
      
      .vcard {
        display: none;
      }
    }
    
    &.children {
      margin: $pad;
    }
  }
  
  
  form {
    width: 60%;
    
    @include mobile {
      width: 90%;
    }
    
    input, textarea {
      margin-bottom: $pad/2;
      
      &#submit {
        width: 15em;
      }
    }
  }
}


/* The sidebar
*/
@mixin sidebar {
  @include bordered;
  padding: $pad*2;
  @include ul;
  
  h3 {
    display: none;
  }
  
  ul {
    @include ol-ul('-');
    li {
      margin: $pad/2 0;
    }
  }
}



/* Display price
*/
@mixin price {
  @include list-inline;
  
  li {
    &:nth-of-type(1) {
      font-weight: bold;
      margin-right: $pad/2;
    }
    
    &:nth-of-type(2) {
      text-decoration: line-through;
      margin-right: 0;
    }
  }
}


/* A white text on a black, opaque background
*/
@mixin black-background {
  position: relative;
  top: -$pad*2 - $pad/4;
  background: $background;
  display: inline-block;
  
  @include bordered;
  border-width: $pad/4;
  padding: $pad;
  @include color(invert);
  
  opacity: .9;
  
  @include mobile {
    border-width: 0;
    top: 0;
    margin-bottom: $pad;
    display: block;
  }
}



/* Highlight a text, even if it is a link
*/
@mixin highlight {
  color: $highlight;
  a {
    @include link($highlight);
  }
}


/* Add border to text
*/
@mixin bordered {
  padding: $pad/2;
  border: 1px solid;
}




html {
  body {
    .container {
      #header {
        h1 {
          @include bordered;
          border: 6px double;
        }
        /* Nav must be adjusted to the bordered header
        */
        nav {
          margin-top: $pad;
          
          @include below-tablet {
            margin-top: $pad/2;
          }
        }
      }
      
      main {
        section {
          header {
            height: 0;
            
            h2 {
              @include bordered; 
              width: auto;
              display: inline-block;
              
              position: relative;
              z-index: 2;
              
              @include color(invert);
              
              border: none;
              top: 6em;
              
              @include mobile {
                display: block;
                width: col-resize(100%, $pad, 2px);
              }
            }
          }
            
          &.articles {
            @include thumb-anvelocom;
            
            article.thumb {
              &:first-of-type {
                figure div, figure figcaption, aside {
                  opacity: 0;
                }
                  
                &:hover {
                  figure div, figure figcaption, aside {
                    opacity: 1;
                  }
                }
              }
            }
            
          }
          
          &#brands.articles {
            @include remove-thumb-anvelocom;
          }
          
          
          &#intro {
            figure {
              figcaption {
                @include black-background;
              }
            }
            /* Figcaption has relative positioning with negative top margin 
            */
            margin-bottom: 0; 
          }
        }
      }
      
      #footer {
        #company {
          @include address;
          address {
            max-width: 35em;
            margin: $pad 0;
          }
        }
      }
    }
  
    /* Archives
    */
    &.page {
      .container {
        main {
          section {
            /* On mobiles the 'Configurator' border is removed
            */
            @include mobile {
              &:nth-of-type(2) {
                header {
                  h2 {
                    border: none;
                    padding-left: 0;
                  }
                }
              }
            }
            
            &#filters {
              ul {
                li {
                  @include color(invert);
                  padding: $pad/4;
                  width: col-resize(isotope-col-width(5), $pad/2, 0px);
                }
              }
            }
          }
        }
      }
    }
    
    /* Single product
    */
    &.single-post {
      main {
        #index {
          article.product {
            @include single;
          }
        }
      }
    }
    
    
    /* Content page
    */
    &.page {
      main {
        #index {
          article.thumb, #comments {
            float: left;
            @include body-text;
          }
          
          article.thumb {
            @include page;
          }
          
          #comments {
            @include comments;
          }
        }
        
        #sidebar {
          @include sidebar;
          width: col-resize($minor - 5%, $pad*4, 2px);
          
          @include below-small-screen {
            padding: $pad;
            width: col-resize(100%, $pad*2, 2px);
          }
        }
      }
    }
  
  }
}

